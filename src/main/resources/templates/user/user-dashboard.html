<!-- Developed by Darren Wunderlich-->
<!-- Updated by Dana Paquet -->
<!-- v3: Unified User + Address Save -->

<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments :: head}"></head>
<body class="container">
<!-- Navbar -->
<nav class="navbar navbar-expand-lg bg-primary" data-bs-theme="dark">
    <div class="container-fluid">
        <a class="navbar-brand" th:href="@{/user/user-dashboard}">Dashboard</a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
                data-bs-target="#navbarColor01" aria-controls="navbarColor01"
                aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarColor01">
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="navbar-brand" th:href="@{/user/user-employment-verification-form}">Employment Verification</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link" th:href="@{/user/logout}">Log Out</a>
                </li>
            </ul>
        </div>
    </div>
</nav>

<header>
    <h1>Welcome, <span th:text="${user.firstName}">User</span>!</h1>
</header>

<!-- -------------- FORM TO UPDATE USER + ADDRESS ----------------- -->
<div class="container-fluid">
<form th:action="@{/user/user-dashboard/save}" method="post">
    <div class="InfoList">
        <!-- User Info -->
        <div class="InfoListCategory">
            <h2>Contact Information:</h2>
            <div class="InfoListItem">
                <p>Email:</p>
                <span class="view-mode" th:text="${user.email}">email@example.com</span>
                <input class="edit-mode" type="email" name="email" th:value="${user.email}" style="display:none;">
            </div>
            <div class="InfoListItem">
                <p>Phone:</p>
                <span class="view-mode" th:text="${user.phone}">(000) 000-0000</span>
                <input class="edit-mode" type="text" name="phone" th:value="${user.phone}" style="display:none;">
            </div>
        </div>

        <!-- Personal Info -->
        <div class="InfoListCategory">
            <h2>Personal Details:</h2>
            <div class="InfoListItem">
                <p>First Name:</p>
                <span class="view-mode" th:text="${user.firstName}">First</span>
                <input class="edit-mode" type="text" name="firstName" th:value="${user.firstName}" style="display:none;">
            </div>
            <div class="InfoListItem">
                <p>Last Name:</p>
                <span class="view-mode" th:text="${user.lastName}">Last</span>
                <input class="edit-mode" type="text" name="lastName" th:value="${user.lastName}" style="display:none;">
            </div>
            <div class="InfoListItem">
                <p>Date of Birth:</p>
                <span class="view-mode" th:text="${#temporals.format(user.dateOfBirth, 'MM/dd/yyyy')}">01/01/1990</span>
                <input class="edit-mode" type="date" name="dateOfBirth" th:value="${user.dateOfBirth}" style="display:none;">
            </div>
            <div class="InfoListItem">
                <p>Personal ID (SSN or ARN):</p>
                <span class="view-mode ssn-container">
                <span id="maskedId"
                      class="masked-id"
                      ondblclick="toggleId()"
                      th:attr="data-full-id=${user.pin}, data-last4=${#strings.substring(user.pin, user.pin.length() - 4)}">
                  ***-**-<span th:text="${#strings.substring(user.pin, user.pin.length() - 4)}">1234</span>
                </span>
                <small style="font-size: 11px; color: gray;">(Double-click to show/hide)</small>
            </span>
                <input class="edit-mode" type="password" id="editPin" name="pin"
                       th:value="${user.pin}" style="display:none;"
                       required pattern="\d{9}" minlength="9" maxlength="9"
                       title="PIN must be exactly 9 digits. Double-click to show or hide value.">
            </div>
        </div>

        <!-- Address Fields -->
        <div class="InfoListCategory">
            <h2>Address:</h2>
            <div class="InfoListItem">
                <p>Street Address:</p>
                <span class="view-mode" th:text="${address != null ? address.street : ''}">123 Main St</span>
                <input class="edit-mode" type="text" name="street" th:value="${address != null ? address.street : ''}" style="display:none;">
            </div>
            <div class="InfoListItem">
                <p>City:</p>
                <span class="view-mode" th:text="${address != null ? address.city : ''}">St. Louis</span>
                <input class="edit-mode" type="text" name="city" th:value="${address != null ? address.city : ''}" style="display:none;">
            </div>
            <div class="InfoListItem">
                <p>ZIP:</p>
                <span class="view-mode" th:text="${address != null ? address.zip : ''}">63101</span>
                <input class="edit-mode" type="text" name="zip" th:value="${address != null ? address.zip : ''}" style="display:none;">
            </div>
            <div class="InfoListItem">
                <p>State:</p>
                <span class="view-mode" th:text="${address != null ? address.state : ''}">MO</span>
                <input class="edit-mode" type="text" name="state" th:value="${address != null ? address.state : ''}" style="display:none;">
            </div>
        </div>

        <!-- Edit Buttons -->
        <div class="EditButton">
            <button type="button" id="editBtn">Edit Details</button>
            <button type="submit" id="saveBtn" style="display:none;">Save All</button>
            <button type="button" id="cancelBtn" style="display:none;">Cancel</button>
        </div>
    </div>
</form>
</div>
<div class="AppStatus">
    <h2>Application Status:</h2>
    <h2>Incomplete</h2>
</div>

<script>
    const editBtn = document.getElementById("editBtn");
    const saveBtn = document.getElementById("saveBtn");
    const cancelBtn = document.getElementById("cancelBtn");

    const viewModeElements = document.querySelectorAll(".view-mode");
    const editModeElements = document.querySelectorAll(".edit-mode");

    editBtn.addEventListener("click", () => {
        viewModeElements.forEach(el => el.style.display = "none");
        editModeElements.forEach(el => el.style.display = "inline-block");
        editBtn.style.display = "none";
        saveBtn.style.display = "inline-block";
        cancelBtn.style.display = "inline-block";
    });

    cancelBtn.addEventListener("click", () => {
        viewModeElements.forEach(el => el.style.display = "inline-block");
        editModeElements.forEach(el => el.style.display = "none");
        editBtn.style.display = "inline-block";
        saveBtn.style.display = "none";
        cancelBtn.style.display = "none";

        const maskedId = document.getElementById("maskedId");
        const last4 = maskedId.getAttribute("data-last4");
        maskedId.textContent = "***-**-" + last4;
    });

    function toggleId() {
        const maskedId = document.getElementById("maskedId");
        const fullId = maskedId.getAttribute("data-full-id");
        const last4 = maskedId.getAttribute("data-last4");

        if (maskedId.textContent.includes("***")) {
            maskedId.textContent = fullId;
        } else {
            maskedId.textContent = "***-**-" + last4;
        }
    }

    document.addEventListener("DOMContentLoaded", function () {
        const pinInput = document.getElementById("editPin");
        if (pinInput) {
            pinInput.addEventListener('dblclick', function () {
                pinInput.type = (pinInput.type === 'password') ? 'text' : 'password';
            });
        }
    });
</script>
</body>
</html>
