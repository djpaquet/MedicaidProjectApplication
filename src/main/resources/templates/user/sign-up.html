<!-- Developed by Bhatti Rajwinder -->
<!-- Updated by Dana Paquet -->
<!-- v2 added masked pin field Updated by Dana Paquet -->
<!-- v3 added form labels Updated by Darren Wunderlich -->

<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org/">
<head th:replace="~{fragments :: head}">
    <title>Medicaid Employment Verification App</title>
</head>

<body>
<nav>
    <a th:href="@{/}" class="active">Home</a>
    <a th:href="@{/user/login}">Applicant</a>
    <a th:href="@{/employer/login}">Employer</a>
    <a href="#adminLogin">Medicaid Employee</a>
</nav>
<div class="form-container">
    <h2>Create Your Account</h2>
    <form id="signupForm" th:action="@{/user/sign-up}" th:object="${user}" method="post" novalidate>
        
        <!-- ========== Personal Information ========== -->
        <fieldset>
            <legend>Personal Information</legend>
            
            <label for="firstName">First Name<span class="req">*</span></label>
            <input type="text" id="firstName" th:field="*{firstName}" placeholder="Enter your first name" required>

            <label for="lastName">Last Name<span class="req">*</span></label>
            <input type="text" id="lastName" th:field="*{lastName}" placeholder="Enter your last name" required>
            
            <label for="dateOfBirth">Date of Birth<span class="req">*</span></label>
            <input type="date" id="dateOfBirth" th:field="*{dateOfBirth}" required>

            <div class="input-with-icon">
                <label for="pin">SSN or ARN<span class="req">*</span></label>
                <input type="password" id="pin" th:field="*{pin}" placeholder="Enter your SSN or ARN"
                       required pattern="\d{9}" title="Double-click to show or hide value"/>
                <i class="bi bi-eye-slash" id="toggleVerifyPin"> </i>
            </div>
            <p th:if="${userPinError}" style="color:red;" th:text="${userPinError}"></p>
        </fieldset>
        
        <!-- ========== Contact Information ========== -->
        <fieldset>
            <legend>Contact Information</legend>
            
            <label for="phone">Phone Number<span class="req">*</span></label>
            <input type="tel" id="phone" th:field="*{phone}" placeholder="e.g. 1235558900" required pattern="[0-9]{10}">

            <label for="email">Email<span class="req">*</span></label>
            <input type="email" id="email" th:field="*{email}" placeholder="Enter your email" required>
            <p th:if="${userEmailError}" style="color:red;" th:text="${userEmailError}"></p>
        </fieldset>
        
        <!-- ========== Account Information ========== -->
        <fieldset>
            <legend>Account Information</legend>
            
            <label for="username">Username<span class="req">*</span></label>
            <input type="text" id="username" th:field="*{username}" placeholder="Choose a username" required minlength="4">
            <p th:if="${userNameError}" style="color:red;" th:text="${userNameError}"></p>
            <div class="input-with-icon">
            <label for="password">Password<span class="req">*</span></label>
            <input type="password" id="password" name="password" placeholder="Create a strong password" required minlength="8"   title="Double-click to show or hide value">
            <i class="bi bi-eye-slash" id="togglePassword"> </i>
            </div>
            <div class="input-with-icon">
            <label for="verifyPassword">Confirm Password<span class="req">*</span></label>
            <input type="password" id="verifyPassword" name="verifyPassword" placeholder="Re-enter password" required minlength="8"   title="Double-click to show or hide value">
            <i class="bi bi-eye-slash" id="toggleVerifyPassword"> </i>
            </div>
            <p th:if="${passwordError}" style="color:red;" th:text="${passwordError}"></p>
        </fieldset>
        <div class="info">
            By creating an account, youâ€™ll be able to save progress, upload employment verification, and receive status updates.
        </div>

        <div class="actions">
            <button type="submit" class="btn-primary">Sign Up</button>
            <button type="reset" class="btn-secondary">Clear</button>
        </div>
    </form>
</div>
<script>
document.addEventListener("DOMContentLoaded", function () {
    // Helper function to toggle visibility and icon
    function setupToggle(toggleId, inputId) {
        const toggle = document.getElementById(toggleId);
        const input = document.getElementById(inputId);
        if (!toggle || !input) return;

        toggle.addEventListener('click', function () {
            const type = input.getAttribute('type') === 'password' ? 'text' : 'password';
            input.setAttribute('type', type);

            // Toggle the eye/eye-slash icon
            this.classList.toggle('bi-eye');
            this.classList.toggle('bi-eye-slash');
        });
    }

    // Set up toggles for all fields
    setupToggle('toggleVerifyPin', 'pin');
    setupToggle('togglePassword', 'password');
    setupToggle('toggleVerifyPassword', 'verifyPassword');


  const form = document.getElementById("signupForm");
  const requiredInputs = form.querySelectorAll("input[required]");

  function showError(input, message) {
    input.classList.add("error");
    let next = input.nextElementSibling;
    if (!next || !next.classList.contains("error-message")) {
      const msg = document.createElement("div");
      msg.className = "error-message";
      msg.textContent = message;
      input.insertAdjacentElement("afterend", msg);
    } else {
      next.textContent = message;
      next.style.display = "block";
    }
  }

  function clearError(input) {
    input.classList.remove("error");
    const next = input.nextElementSibling;
    if (next && next.classList.contains("error-message")) {
      next.style.display = "none";
    }
  }

  form.addEventListener("submit", function (e) {
    let valid = true;

    requiredInputs.forEach(input => {
      clearError(input);
      const value = input.value.trim();

      if (!value) {
        showError(input, "This field is required");
        valid = false;
        return;
      }

      switch (input.id) {
        case "pin":
          if (!/^\d{9}$/.test(value)) {
            showError(input, "SSN or ARN must be exactly 9 digits");
            valid = false;
          }
          break;
        case "phone":
          if (!/^\d{10}$/.test(value)) {
            showError(input, "Phone number must be 10 digits");
            valid = false;
          }
          break;
        case "email":
          if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
            showError(input, "Invalid email format");
            valid = false;
          }
          break;
        case "password":
          if (value.length < 8) {
            showError(input, "Password must be at least 8 characters");
            valid = false;
          }
          break;
        case "verifyPassword":
          const passwordValue = document.getElementById("password").value.trim();
          if (value !== passwordValue) {
            showError(input, "Passwords do not match");
            valid = false;
          }
          break;
      }
    });

    if (!valid) e.preventDefault();
  });

  form.addEventListener("input", e => {
    if (e.target.matches("input[required]")) {
      clearError(e.target);
    }
  });
});

</script>
</body>
</html>
