<!-- Developed by Bhatti Rajwinder -->
<!-- Updated by Dana Paquet and improved with labeled sections -->

<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{fragments :: head}">
    <meta charset="UTF-8">
    <title>Employer Sign Up</title>
</head>
<body>
<nav>
    <a th:href="@{/}" class="active">Home</a>
    <a th:href="@{/user/login}">Applicant</a>
    <a th:href="@{/employer/login}">Employer</a>
    <a href="#adminLogin">Medicaid Employee</a>
</nav>
<div class="form-container" id="signupSection">
    <h2>Create Your Account â€“ Employer Use Only</h2>

    <form id="employerSignupForm"  th:action="@{/employer/sign-up}" th:object="${employer}" method="post" novalidate>

        <!-- ========== Company Information ========== -->
        <fieldset>
            <legend>Company Information</legend>

            <label for="employerName">Company Name<span class="req">*</span></label>
            <input type="text" id="employerName" th:field="*{employerName}" placeholder="Enter company name" required>

            <label for="employerTaxId">Employer Tax ID<span class="req">*</span></label>
            <input type="text" id="employerTaxId" th:field="*{employerTaxId}" placeholder="Enter employer tax ID" required>
        </fieldset>

        <!-- ========== Contact Information ========== -->
        <fieldset>
            <legend>Contact Information (Person to Contact at Employer)</legend>

            <label for="firstName">First Name<span class="req">*</span></label>
            <input type="text" id="firstName" th:field="*{firstName}" placeholder="Contact first name" required>

            <label for="lastName">Last Name<span class="req">*</span></label>
            <input type="text" id="lastName" th:field="*{lastName}" placeholder="Contact last name" required>

            <label for="phone">Phone Number<span class="req">*</span></label>
            <input type="tel" id="phone" th:field="*{phone}" placeholder="Contact number 5551235555" pattern="[0-9]{10}" required>

            <label for="email">Email<span class="req">*</span></label>
            <input type="email" id="email" th:field="*{email}" placeholder="example@company.com" required>
            <p th:if="${emailError}" style="color:red;" th:text="${emailError}"></p>
        </fieldset>

        <!-- ========== Address Information ========== -->
        <fieldset>
            <legend>Company Address</legend>

            <label for="street">Street Address<span class="req">*</span></label>
            <input type="text" id="street" name="address" placeholder="123 Main St" required>

            <label for="city">City<span class="req">*</span></label>
            <input type="text" id="city" name="city" required>

            <label for="state">State<span class="req">*</span></label>
            <input type="text" id="state" name="state" required>

            <label for="zip">ZIP<span class="req">*</span></label>
            <input type="text" id="zip" name="zip" required>
        </fieldset>

        <!-- ========== Account Security ========== -->
        <fieldset>
            <legend>Account Security</legend>

            <label for="password">Password<span class="req">*</span></label>
            <input type="password" id="password" th:field="*{password}" minlength="8" title="Double-click to show or hide value" required>

            <label for="verifyPassword">Confirm Password<span class="req">*</span></label>
            <input type="password" id="verifyPassword" th:field="*{verifyPassword}" minlength="8" title="Double-click to show or hide value" required>
        </fieldset>

        <div class="actions">
            <button type="submit" class="btn-primary">Sign Up</button>
            <button type="reset" class="btn-secondary">Clear</button>
        </div>
    </form>
</div>

<script>
document.addEventListener("DOMContentLoaded", function () {
  // Password visibility toggle
  const togglableFields = ['password', 'verifyPassword'];
  togglableFields.forEach(id => {
    const input = document.getElementById(id);
    if (input) {
      input.addEventListener('dblclick', function () {
        input.type = input.type === 'password' ? 'text' : 'password';
      });
    }
  });

  const form = document.getElementById("employerSignupForm");
  const requiredInputs = form.querySelectorAll("input[required]");

  function showError(input, message) {
    input.classList.add("error");
    let next = input.nextElementSibling;
    if (!next || !next.classList.contains("error-message")) {
      const msg = document.createElement("div");
      msg.className = "error-message";
      msg.textContent = message;
      input.insertAdjacentElement("afterend", msg);
    } else {
      next.textContent = message;
      next.style.display = "block";
    }
  }

  function clearError(input) {
    input.classList.remove("error");
    const next = input.nextElementSibling;
    if (next && next.classList.contains("error-message")) {
      next.style.display = "none";
    }
  }

  form.addEventListener("submit", function (e) {
    let valid = true;

    requiredInputs.forEach(input => {
      clearError(input);
      const value = input.value.trim();

      if (!value) {
        showError(input, "This field is required");
        valid = false;
        return;
      }

      switch (input.id) {
        case "email":
          if (!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value)) {
            showError(input, "Invalid email format");
            valid = false;
          }
          break;
        case "phone":
          if (!/^\d{10}$/.test(value)) {
            showError(input, "Phone number must be 10 digits");
            valid = false;
          }
          break;
        case "zip":
          if (!/^\d{5}$/.test(value)) {
            showError(input, "ZIP code must be 5 digits");
            valid = false;
          }
          break;
        case "password":
          if (value.length < 8) {
            showError(input, "Password must be at least 8 characters");
            valid = false;
          }
          break;
        case "verifyPassword":
          const passwordValue = document.getElementById("password").value.trim();
          if (value !== passwordValue) {
            showError(input, "Passwords do not match");
            valid = false;
          }
          break;
      }
    });

    if (!valid) e.preventDefault();
  });

  form.addEventListener("input", e => {
    if (e.target.matches("input[required]")) {
      clearError(e.target);
    }
  });
});
</script>

</body>
</html>
